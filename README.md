# SM2_Synergism_Algorithm

Create in 2021 / 11 / 16

## 1、Instruction

### SM2协同计算算法

### 关键点：

- 随机数的生成过程

    随机数的生成参考: https://github.com/Tencent/secguide/blob/main/C%2CC%2B%2B%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97.md#44--%E5%BF%85%E9%A1%BB%E5%9C%A8%E9%9C%80%E8%A6%81%E9%AB%98%E5%BC%BA%E5%BA%A6%E5%AE%89%E5%85%A8%E5%8A%A0%E5%AF%86%E6%97%B6%E4%B8%8D%E5%BA%94%E4%BD%BF%E7%94%A8%E5%BC%B1prng%E5%87%BD%E6%95%B0

    具体参考(openssl):
    https://www.openssl.org/docs/man1.1.1/man3/RAND_bytes.html

- 协同签名的过程
- 协同解密的过程

### 设计难点一：

- 如何实现参与签名或解密的双方进行安全的数据传输

### 目前想到的设计的方案：

- 用一个类来定义客户端/服务端
- 类中成员包括socket, socketAddr, privateKey等变量
- 同时还需要包括在协同计算过程中对数据的计算函数(计算函数对外不可见)

#### 1) 针对上面的第一点的设计方案：

- 由于客户端与服务端的计算有所差异，不能单纯将这个类统称为客户端或服务端
- 但是客户端与服务端有共同的接口以及部分成员，对此我们可以利用基类继承的方式
- 先定义一个虚基类来存储双方共同的部分，再利用继承生成客户端/服务端，各自实现自己的部分


#### 2) 针对上面的第三点的设计方案：

##### 2.1 将数据计算函数用一个接口函数来管理

- 可以将数据计算各自封装成一个独立的函数，然后用一个接口函数来管理，传入参数包括顺序号和可变参数
- 根据顺序号，利用switch来选择哪一步的计算函数(类内调用对外不可见的函数)
- 每次的数据计算包括本次计算过程还有传输下一步数据的过程(或者返回数据)

##### 2.2 直接调用每一步的数据计算函数
- 将每一步数据计算封装成一个函数
- 计算的时候直接调用对应的函数

上面两个针对第三点的方案有共同的缺点：

将发送到对端这个操作作为一个节点，分别封装每一节的计算过程到函数中，这样做不易于维护，在修改某一式子可能需要调整所有有关的函数函数

##### 2.3 直接将整个协同计算写到一个函数下

- 需要注意的是在发送完数据给对端时，如果后续还有计算，则需要将线程设置为阻塞态，不断监听接收通道
- 直到有数据到达为止，协同计算函数再往下计算









